# ArchDash å‚æ•°æ•æ„Ÿæ€§åˆ†æç»˜å›¾åŠŸèƒ½å®æ–½è®¡åˆ’

## åŠŸèƒ½æ¦‚è¿°

åœ¨ArchDashåº”ç”¨çš„æœ€å³ä¾§æ·»åŠ ä¸€ä¸ªå‚æ•°æ•æ„Ÿæ€§åˆ†æç»˜å›¾åŒºåŸŸï¼Œç”¨äºå¯è§†åŒ–å‚æ•°ä¹‹é—´çš„å…³ç³»ã€‚ç”¨æˆ·å¯ä»¥é€‰æ‹©ä¸€ä¸ªç‹¬ç«‹å‚æ•°ä½œä¸ºXè½´ï¼Œä¸€ä¸ªä¾èµ–å‚æ•°ä½œä¸ºYè½´ï¼Œè§‚å¯Ÿå½“Xè½´å‚æ•°åœ¨æŒ‡å®šèŒƒå›´å†…å˜åŒ–æ—¶ï¼ŒYè½´å‚æ•°çš„å“åº”æ›²çº¿ã€‚

## åŠŸèƒ½éœ€æ±‚

### æ ¸å¿ƒåŠŸèƒ½
1. **å‚æ•°é€‰æ‹©**ï¼šé€‰æ‹©Xè½´å‚æ•°ï¼ˆç‹¬ç«‹å˜é‡ï¼‰å’ŒYè½´å‚æ•°ï¼ˆä¾èµ–å˜é‡ï¼‰
2. **èŒƒå›´è®¾ç½®**ï¼šè®¾ç½®Xè½´å‚æ•°çš„å˜åŒ–èŒƒå›´ï¼ˆèµ·å§‹å€¼ã€ç»“æŸå€¼ã€æ­¥é•¿ï¼‰
3. **å®æ—¶ç»˜å›¾**ï¼šåŸºäºå‚æ•°å…³ç³»ç”Ÿæˆå“åº”æ›²çº¿
4. **äº¤äº’å¼å›¾è¡¨**ï¼šæ”¯æŒç¼©æ”¾ã€å¹³ç§»ã€æ•°æ®ç‚¹æ˜¾ç¤ºç­‰

### é«˜çº§åŠŸèƒ½
1. **å¤šæ›²çº¿å¯¹æ¯”**ï¼šåŒæ—¶ç»˜åˆ¶å¤šä¸ªYå‚æ•°çš„å“åº”æ›²çº¿
2. **å‚æ•°å¯¼å‡º**ï¼šå¯¼å‡ºç»˜å›¾æ•°æ®ä¸ºCSVæˆ–JSON
3. **å›¾è¡¨å¯¼å‡º**ï¼šå¯¼å‡ºå›¾è¡¨ä¸ºPNGæˆ–SVG

## æŠ€æœ¯æ¶æ„

### å‰ç«¯UIç»„ä»¶
```
ç»˜å›¾åŒºåŸŸå¸ƒå±€ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            å‚æ•°æ•æ„Ÿæ€§åˆ†æ              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Xè½´å‚æ•°: [é€‰æ‹©å™¨] Yè½´å‚æ•°: [é€‰æ‹©å™¨]    â”‚
â”‚ èµ·å§‹å€¼: [è¾“å…¥] ç»“æŸå€¼: [è¾“å…¥]        â”‚
â”‚ æ­¥é•¿: [è¾“å…¥] [ç»˜å›¾æŒ‰é’®] [æ¸…é™¤æŒ‰é’®]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                   â”‚
â”‚          å›¾è¡¨æ˜¾ç¤ºåŒºåŸŸ                â”‚
â”‚                                   â”‚
â”‚                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¾èµ–åº“
- **Plotly**: ç”¨äºäº¤äº’å¼å›¾è¡¨ç»˜åˆ¶
- **NumPy**: ç”¨äºæ•°å€¼è®¡ç®—å’Œæ•°ç»„æ“ä½œ
- **Pandas**: ç”¨äºæ•°æ®å¤„ç†ï¼ˆå¯é€‰ï¼‰

### æ•°æ®æµç¨‹
1. ç”¨æˆ·é€‰æ‹©Xè½´å’ŒYè½´å‚æ•°
2. è®¾ç½®Xè½´å‚æ•°çš„å˜åŒ–èŒƒå›´
3. ç³»ç»Ÿåœ¨èŒƒå›´å†…é€æ­¥æ”¹å˜Xè½´å‚æ•°å€¼
4. è§¦å‘ä¾èµ–è®¡ç®—ï¼Œè·å–å¯¹åº”çš„Yè½´å‚æ•°å€¼
5. æ”¶é›†æ‰€æœ‰æ•°æ®ç‚¹ï¼Œç”Ÿæˆå›¾è¡¨

## å®æ–½æ­¥éª¤

### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€UIæ¡†æ¶
1. **å¸ƒå±€è°ƒæ•´**
   - å°†å½“å‰ç”»å¸ƒå®¹å™¨ä»12åˆ—è°ƒæ•´ä¸º8åˆ—
   - æ–°å¢4åˆ—å®½çš„ç»˜å›¾åŒºåŸŸå®¹å™¨
   - ç¡®ä¿å“åº”å¼è®¾è®¡

2. **ç»˜å›¾åŒºåŸŸç»„ä»¶**
   ```python
   # ç»˜å›¾åŒºåŸŸåŸºç¡€ç»“æ„
   plotting_area = dbc.Col([
       html.H5("å‚æ•°æ•æ„Ÿæ€§åˆ†æ", className="text-center mb-3"),
       
       # å‚æ•°é€‰æ‹©åŒºåŸŸ
       dbc.Card([
           dbc.CardBody([
               dbc.Row([
                   dbc.Col([
                       dbc.Label("Xè½´å‚æ•°:"),
                       dcc.Dropdown(id="x-param-selector", placeholder="é€‰æ‹©Xè½´å‚æ•°")
                   ], width=6),
                   dbc.Col([
                       dbc.Label("Yè½´å‚æ•°:"),
                       dcc.Dropdown(id="y-param-selector", placeholder="é€‰æ‹©Yè½´å‚æ•°")
                   ], width=6),
               ], className="mb-3"),
               
               dbc.Row([
                   dbc.Col([
                       dbc.Label("èµ·å§‹å€¼:"),
                       dbc.Input(id="x-start-value", type="number", value=0)
                   ], width=4),
                   dbc.Col([
                       dbc.Label("ç»“æŸå€¼:"),
                       dbc.Input(id="x-end-value", type="number", value=100)
                   ], width=4),
                   dbc.Col([
                       dbc.Label("æ­¥é•¿:"),
                       dbc.Input(id="x-step-value", type="number", value=1)
                   ], width=4),
               ], className="mb-3"),
               
               dbc.Row([
                   dbc.Col([
                       dbc.ButtonGroup([
                           dbc.Button("ğŸ”„ ç”Ÿæˆå›¾è¡¨", id="generate-plot-btn", color="primary"),
                           dbc.Button("ğŸ—‘ï¸ æ¸…é™¤", id="clear-plot-btn", color="secondary"),
                           dbc.Button("ğŸ“Š å¯¼å‡ºæ•°æ®", id="export-plot-data-btn", color="info")
                       ])
                   ])
               ])
           ])
       ], className="mb-3"),
       
       # å›¾è¡¨æ˜¾ç¤ºåŒºåŸŸ
       dbc.Card([
           dbc.CardBody([
               dcc.Graph(
                   id="sensitivity-plot",
                   style={"height": "400px"},
                   config={
                       'displayModeBar': True,
                       'modeBarButtonsToRemove': ['pan2d', 'lasso2d']
                   }
               )
           ])
       ])
   ], width=4)
   ```

### ç¬¬äºŒé˜¶æ®µï¼šå‚æ•°é€‰æ‹©é€»è¾‘
1. **å‚æ•°æ”¶é›†å‡½æ•°**
   ```python
   def get_plotting_parameters():
       """è·å–æ‰€æœ‰å¯ç”¨äºç»˜å›¾çš„å‚æ•°"""
       all_params = []
       for node_id, node in graph.nodes.items():
           for param in node.parameters:
               all_params.append({
                   'label': f"{node.name}.{param.name}",
                   'value': f"{node_id}|{param.name}",
                   'node_id': node_id,
                   'param_name': param.name,
                   'param_obj': param,
                   'current_value': param.value,
                   'unit': param.unit
               })
       return all_params
   ```

2. **åŠ¨æ€æ›´æ–°ä¸‹æ‹‰é€‰æ‹©å™¨**
   ```python
   @callback(
       Output("x-param-selector", "options"),
       Output("y-param-selector", "options"),
       Input("canvas-container", "children"),
       prevent_initial_call=True
   )
   def update_param_selectors(canvas_children):
       params = get_plotting_parameters()
       return params, params
   ```

### ç¬¬ä¸‰é˜¶æ®µï¼šæ•æ„Ÿæ€§åˆ†ææ ¸å¿ƒç®—æ³•
1. **å‚æ•°æ‰«æå‡½æ•°**
   ```python
   def perform_sensitivity_analysis(x_param_info, y_param_info, x_start, x_end, x_step):
       """æ‰§è¡Œå‚æ•°æ•æ„Ÿæ€§åˆ†æ"""
       x_node_id, x_param_name = x_param_info['value'].split('|')
       y_node_id, y_param_name = y_param_info['value'].split('|')
       
       # è·å–å‚æ•°å¯¹è±¡
       x_param = graph.nodes[x_node_id].get_parameter_by_name(x_param_name)
       y_param = graph.nodes[y_node_id].get_parameter_by_name(y_param_name)
       
       # ä¿å­˜åŸå§‹å€¼
       original_x_value = x_param.value
       
       x_values = []
       y_values = []
       
       try:
           # ç”ŸæˆXè½´å–å€¼èŒƒå›´
           x_range = np.arange(x_start, x_end + x_step, x_step)
           
           for x_val in x_range:
               # è®¾ç½®Xå‚æ•°å€¼
               if hasattr(graph, 'set_parameter_value'):
                   graph.set_parameter_value(x_param, x_val)
               else:
                   x_param.value = x_val
                   
               # å¦‚æœYå‚æ•°æœ‰è®¡ç®—å‡½æ•°ï¼Œè§¦å‘é‡æ–°è®¡ç®—
               if y_param.calculation_func:
                   try:
                       y_param.calculate()
                   except Exception as e:
                       print(f"è®¡ç®—é”™è¯¯ (X={x_val}): {e}")
                       continue
               
               x_values.append(x_val)
               y_values.append(y_param.value)
           
           return {
               'x_values': x_values,
               'y_values': y_values,
               'x_label': f"{x_param_info['label']} ({x_param.unit})",
               'y_label': f"{y_param_info['label']} ({y_param.unit})",
               'success': True,
               'message': f"æˆåŠŸç”Ÿæˆ {len(x_values)} ä¸ªæ•°æ®ç‚¹"
           }
           
       except Exception as e:
           return {
               'success': False,
               'message': f"åˆ†æå¤±è´¥: {str(e)}"
           }
       finally:
           # æ¢å¤åŸå§‹å€¼
           if hasattr(graph, 'set_parameter_value'):
               graph.set_parameter_value(x_param, original_x_value)
           else:
               x_param.value = original_x_value
   ```

### ç¬¬å››é˜¶æ®µï¼šå›¾è¡¨ç»˜åˆ¶
1. **Plotlyå›¾è¡¨ç”Ÿæˆ**
   ```python
   @callback(
       Output("sensitivity-plot", "figure"),
       Output("output-result", "children", allow_duplicate=True),
       Input("generate-plot-btn", "n_clicks"),
       State("x-param-selector", "value"),
       State("y-param-selector", "value"),
       State("x-start-value", "value"),
       State("x-end-value", "value"),
       State("x-step-value", "value"),
       prevent_initial_call=True
   )
   def generate_sensitivity_plot(n_clicks, x_param, y_param, x_start, x_end, x_step):
       if not n_clicks or not x_param or not y_param:
           return {}, "è¯·é€‰æ‹©å‚æ•°å¹¶ç‚¹å‡»ç”Ÿæˆå›¾è¡¨"
       
       # è·å–å‚æ•°ä¿¡æ¯
       all_params = get_plotting_parameters()
       x_param_info = next((p for p in all_params if p['value'] == x_param), None)
       y_param_info = next((p for p in all_params if p['value'] == y_param), None)
       
       if not x_param_info or not y_param_info:
           return {}, "å‚æ•°é€‰æ‹©é”™è¯¯"
       
       # æ‰§è¡Œæ•æ„Ÿæ€§åˆ†æ
       result = perform_sensitivity_analysis(
           x_param_info, y_param_info, 
           x_start or 0, x_end or 100, x_step or 1
       )
       
       if not result['success']:
           return {}, result['message']
       
       # åˆ›å»ºPlotlyå›¾è¡¨
       import plotly.graph_objects as go
       
       fig = go.Figure()
       
       fig.add_trace(go.Scatter(
           x=result['x_values'],
           y=result['y_values'],
           mode='lines+markers',
           name=f"{y_param_info['label']}",
           line=dict(width=2),
           marker=dict(size=6)
       ))
       
       fig.update_layout(
           title=f"å‚æ•°æ•æ„Ÿæ€§åˆ†æ: {result['y_label']} vs {result['x_label']}",
           xaxis_title=result['x_label'],
           yaxis_title=result['y_label'],
           hovermode='x unified',
           template="plotly_white",
           showlegend=True
       )
       
       return fig, result['message']
   ```

### ç¬¬äº”é˜¶æ®µï¼šé«˜çº§åŠŸèƒ½
1. **å¤šæ›²çº¿ç»˜åˆ¶**
   - æ”¯æŒé€‰æ‹©å¤šä¸ªYè½´å‚æ•°
   - åœ¨åŒä¸€å›¾è¡¨ä¸­æ˜¾ç¤ºå¤šæ¡æ›²çº¿
   - ä¸åŒé¢œè‰²åŒºåˆ†ä¸åŒå‚æ•°

2. **æ•°æ®å¯¼å‡ºåŠŸèƒ½**
   ```python
   @callback(
       Output("download-plot-data", "data"),
       Input("export-plot-data-btn", "n_clicks"),
       State("sensitivity-plot", "figure"),
       prevent_initial_call=True
   )
   def export_plot_data(n_clicks, figure):
       if not n_clicks or not figure:
           raise dash.exceptions.PreventUpdate
       
       # æå–å›¾è¡¨æ•°æ®å¹¶å¯¼å‡ºä¸ºCSV
       # ... å®ç°æ•°æ®å¯¼å‡ºé€»è¾‘
   ```

## æŠ€æœ¯æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ

### 1. å‚æ•°ä¾èµ–è®¡ç®—
**æŒ‘æˆ˜**: æ”¹å˜Xè½´å‚æ•°å€¼æ—¶ï¼Œéœ€è¦æ­£ç¡®è§¦å‘ä¾èµ–é“¾çš„é‡æ–°è®¡ç®—
**è§£å†³æ–¹æ¡ˆ**: 
- åˆ©ç”¨ç°æœ‰çš„`graph.set_parameter_value()`æ–¹æ³•
- ç¡®ä¿æ‰€æœ‰ä¾èµ–å‚æ•°éƒ½èƒ½æ­£ç¡®æ›´æ–°

### 2. æ€§èƒ½ä¼˜åŒ–
**æŒ‘æˆ˜**: å¤§èŒƒå›´å‚æ•°æ‰«æå¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜
**è§£å†³æ–¹æ¡ˆ**:
- é™åˆ¶æœ€å¤§æ•°æ®ç‚¹æ•°é‡ï¼ˆå¦‚1000ä¸ªç‚¹ï¼‰
- æ·»åŠ è¿›åº¦æŒ‡ç¤ºå™¨
- æ”¯æŒå¼‚æ­¥è®¡ç®—ï¼ˆå¦‚æœéœ€è¦ï¼‰

### 3. å‚æ•°ç±»å‹å…¼å®¹
**æŒ‘æˆ˜**: ä¸åŒç±»å‹çš„å‚æ•°å€¼ï¼ˆæ•°å€¼ã€å­—ç¬¦ä¸²ï¼‰çš„å¤„ç†
**è§£å†³æ–¹æ¡ˆ**:
- åªå…è®¸æ•°å€¼ç±»å‹å‚æ•°ä½œä¸ºXè½´
- æ·»åŠ å‚æ•°ç±»å‹æ£€æŸ¥å’ŒéªŒè¯

### 4. é”™è¯¯å¤„ç†
**æŒ‘æˆ˜**: è®¡ç®—è¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°å„ç§é”™è¯¯
**è§£å†³æ–¹æ¡ˆ**:
- å®Œå–„çš„å¼‚å¸¸æ•è·å’Œé”™è¯¯ä¿¡æ¯æ˜¾ç¤º
- æä¾›è®¡ç®—å¤±è´¥æ—¶çš„å›é€€æœºåˆ¶

## ç”¨æˆ·ä½“éªŒè®¾è®¡

### ç•Œé¢äº¤äº’æµç¨‹
1. ç”¨æˆ·åœ¨å·¦ä¾§åˆ›å»ºèŠ‚ç‚¹å’Œå‚æ•°ï¼Œå»ºç«‹ä¾èµ–å…³ç³»
2. åœ¨å³ä¾§ç»˜å›¾åŒºåŸŸé€‰æ‹©è¦åˆ†æçš„å‚æ•°
3. è®¾ç½®Xè½´å‚æ•°çš„å˜åŒ–èŒƒå›´
4. ç‚¹å‡»"ç”Ÿæˆå›¾è¡¨"æŒ‰é’®
5. æŸ¥çœ‹ç”Ÿæˆçš„æ•æ„Ÿæ€§åˆ†æå›¾è¡¨
6. å¯é€‰ï¼šå¯¼å‡ºæ•°æ®æˆ–è°ƒæ•´å‚æ•°é‡æ–°ç»˜åˆ¶

### è§†è§‰è®¾è®¡
- é‡‡ç”¨Bootstrapä¸»é¢˜ä¿æŒä¸€è‡´æ€§
- ç»˜å›¾åŒºåŸŸä½¿ç”¨å¡ç‰‡å¸ƒå±€ï¼Œæ¸…æ™°åˆ†å‰²åŠŸèƒ½åŒºåŸŸ
- å›¾è¡¨ä½¿ç”¨Plotlyé»˜è®¤çš„ç°ä»£åŒ–æ ·å¼
- æ·»åŠ é€‚å½“çš„åŠ è½½åŠ¨ç”»å’ŒçŠ¶æ€æç¤º

## å®æ–½æ—¶é—´ä¼°ç®—

1. **ç¬¬ä¸€é˜¶æ®µ (UIæ¡†æ¶)**: 1-2å¤©
2. **ç¬¬äºŒé˜¶æ®µ (å‚æ•°é€‰æ‹©)**: 1å¤©
3. **ç¬¬ä¸‰é˜¶æ®µ (æ ¸å¿ƒç®—æ³•)**: 2-3å¤©
4. **ç¬¬å››é˜¶æ®µ (å›¾è¡¨ç»˜åˆ¶)**: 1-2å¤©
5. **ç¬¬äº”é˜¶æ®µ (é«˜çº§åŠŸèƒ½)**: 2-3å¤©
6. **æµ‹è¯•å’Œä¼˜åŒ–**: 1-2å¤©

**æ€»è®¡**: 8-13å¤©

## åç»­æ‰©å±•è®¡åˆ’

1. **3Då‚æ•°åˆ†æ**: æ”¯æŒä¸¤ä¸ªç‹¬ç«‹å‚æ•°çš„3Dæ›²é¢åˆ†æ
2. **å‚æ•°ä¼˜åŒ–**: é›†æˆä¼˜åŒ–ç®—æ³•ï¼Œå¯»æ‰¾æœ€ä¼˜å‚æ•°ç»„åˆ
3. **ä¸ç¡®å®šæ€§åˆ†æ**: åŸºäºå‚æ•°ç½®ä¿¡åº¦çš„è’™ç‰¹å¡æ´›åˆ†æ
4. **æ‰¹é‡åˆ†æ**: æ”¯æŒå¤šç»„å‚æ•°çš„æ‰¹é‡æ•æ„Ÿæ€§åˆ†æ 