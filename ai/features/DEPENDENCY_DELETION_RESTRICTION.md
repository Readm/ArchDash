# 依赖删除限制功能

## 功能概述

为了保护计算图的完整性，系统现在会阻止删除被其他参数依赖的参数或节点。这可以防止意外破坏参数间的依赖关系。

## 功能特性

### 1. 参数删除限制
- 当尝试删除一个被其他参数依赖的参数时，系统会阻止删除并显示详细的依赖信息
- 显示哪些参数依赖于要删除的参数

### 2. 节点删除限制  
- 当尝试删除一个节点时，系统会检查该节点的所有参数是否被其他参数依赖
- 如果任何参数被依赖，则阻止删除整个节点
- 显示被依赖的参数以及依赖它们的参数列表

## 实现原理

### 核心函数

#### `check_parameter_has_dependents(param_obj)`
检查单个参数是否被其他参数依赖：
- **输入**: 参数对象
- **返回**: `(has_dependents: bool, dependent_list: list)`
  - `has_dependents`: 是否有依赖
  - `dependent_list`: 依赖参数的详细信息列表

#### `check_node_has_dependents(node_id)`  
检查节点的所有参数是否被依赖：
- **输入**: 节点ID
- **返回**: `(has_dependents: bool, dependent_info: dict)`
  - `has_dependents`: 是否有参数被依赖
  - `dependent_info`: 详细的依赖信息

### 集成点

1. **参数删除**: 在 `handle_parameter_operations` 函数中的 `delete-param` 操作
2. **节点删除**: 在 `handle_node_operations` 函数中的 `delete-node` 操作

## 使用示例

### 场景1: 删除被依赖的参数
```
输入节点:
├── 长度 = 10.0 m
└── 宽度 = 5.0 m

计算节点:  
└── 面积 = 长度 × 宽度
```

尝试删除"长度"参数时，系统会显示：
```
❌ 无法删除参数 输入节点.长度，因为以下参数依赖于它：
计算节点.面积
```

### 场景2: 删除包含被依赖参数的节点
尝试删除"输入节点"时，系统会显示：
```
❌ 无法删除节点 输入节点，因为该节点的以下参数被其他参数依赖：
• 长度 被依赖于：计算节点.面积
• 宽度 被依赖于：计算节点.面积
```

### 场景3: 删除不被依赖的参数/节点
如果参数或节点没有被其他参数依赖，删除操作会正常执行：
```
✅ 参数 节点名.参数名 已删除
```
或
```
✅ 节点 节点名 已删除
```

## 依赖链检测

系统能够正确处理复杂的依赖链，例如：
```
A → B → C → D
```

在这种情况下：
- A 被 B 依赖，无法删除
- B 被 C 依赖，无法删除  
- C 被 D 依赖，无法删除
- D 不被任何参数依赖，可以删除

## 错误消息格式

### 参数删除错误
```
❌ 无法删除参数 [节点名].[参数名]，因为以下参数依赖于它：
[依赖节点名1].[依赖参数名1], [依赖节点名2].[依赖参数名2]
```

### 节点删除错误
```
❌ 无法删除节点 [节点名]，因为该节点的以下参数被其他参数依赖：
• [被依赖参数1] 被依赖于：[依赖参数列表]
• [被依赖参数2] 被依赖于：[依赖参数列表]
```

## 测试覆盖

- ✅ 单参数依赖检测
- ✅ 多参数依赖检测  
- ✅ 节点级依赖检测
- ✅ 复杂依赖链检测
- ✅ 无依赖情况的正常删除
- ✅ 错误消息格式验证

## 注意事项

1. **性能**: 对于大型图，依赖检查可能需要一些时间，因为需要遍历所有参数
2. **用户体验**: 错误消息会清楚地解释为什么无法删除，帮助用户理解依赖关系
3. **数据完整性**: 这个功能确保计算图的完整性，防止意外破坏依赖关系

## 未来改进

1. **批量删除**: 考虑在删除节点时，同时清理相关的依赖关系
2. **依赖可视化**: 在UI中显示依赖关系图，帮助用户更好地理解结构
3. **强制删除**: 提供高级选项，允许用户强制删除并自动清理依赖关系 