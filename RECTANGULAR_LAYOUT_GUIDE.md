# 长方形节点与列式布局指南

## 🎉 新的视觉设计

现在您的图形可视化工具采用了全新的长方形节点设计和列式布局，提供更清晰的参数组织和视觉效果！

## 📐 设计特点

### 🔲 长方形节点
- **形状**: 标准长方形替代原来的圆形
- **尺寸**: 宽度1.8单位，高度0.6单位
- **边框**: 白色边框，宽度2像素
- **颜色**: 蓝色(基础参数) / 绿色(计算参数)

### 📋 列式布局
- **左列**: 基础参数 (Basic Parameters)
- **右列**: 计算参数 (Computed Parameters)
- **多列支持**: 计算参数过多时自动扩展到多列
- **垂直居中**: 每列内的参数垂直居中对齐

## 🎯 布局规则

### 位置计算
```
基础参数列:
- X坐标: -2.0 (固定左侧)
- Y坐标: 根据参数数量垂直分布

计算参数列:
- X坐标: 2.0, 6.0, 10.0... (每列间距4.0)
- Y坐标: 根据每列参数数量垂直分布
- 列平衡: 每列最多6个参数
```

### 间距设置
- **节点间距**: 垂直1.5单位
- **列间距**: 水平4.0单位  
- **边距**: 图形边界适当留白

## 🎨 视觉元素

### 列标题
- **基础参数列**: "Basic Parameters" (蓝色标题)
- **计算参数列**: "Computed Parameters" (绿色标题)
- **位置**: 每列顶部，背景白色带边框

### 交互区域
- **文本显示**: 白色字体，居中显示参数名
- **点击区域**: 透明的30像素点击区域
- **悬停效果**: 完整的参数信息提示

### 依赖箭头
- **方向**: 从依赖参数指向目标参数
- **样式**: 灰色箭头，清晰可见
- **路径**: 自动计算最佳路径

## 🔧 技术实现

### 形状绘制
```javascript
// 使用Plotly的add_shape方法绘制长方形
fig.add_shape(
    type="rect",
    x0=pos[0] - width/2,   // 左边界
    y0=pos[1] - height/2,  // 下边界  
    x1=pos[0] + width/2,   // 右边界
    y1=pos[1] + height/2,  // 上边界
    fillcolor=color,       // 填充颜色
    opacity=0.8           // 透明度
)
```

### 布局算法
```python
# 分离参数类型
basic_params = [基础参数列表]
computed_params = [计算参数列表]

# 计算位置
for 基础参数:
    x = -2.0  # 固定左列
    y = 垂直分布计算

for 计算参数:
    column = i // 每列最大数量
    x = -2.0 + 4.0 * (column + 1)
    y = 该列内垂直分布
```

## 📊 优势对比

### 相比圆形布局:
- ✅ **更清晰的分类**: 基础/计算参数明确分离
- ✅ **更好的可读性**: 长方形容纳更多文本
- ✅ **更整齐的排列**: 列式布局更有序
- ✅ **更容易扩展**: 支持大量参数的多列显示

### 相比圆形布局:
- ✅ **空间利用**: 长方形空间利用率更高
- ✅ **视觉对比**: 颜色分类更明显
- ✅ **交互精度**: 更大的点击区域
- ✅ **专业外观**: 更符合流程图标准

## 🎮 使用体验

### 查看参数
1. **基础参数**: 在左侧蓝色列中查找
2. **计算参数**: 在右侧绿色列中查找
3. **参数详情**: 悬停查看完整信息
4. **依赖关系**: 通过箭头查看连接

### 交互操作
1. **单击节点**: 弹出上下文菜单
2. **跳转代码**: 选择"Jump to Code"精确定位
3. **复制名称**: 选择"Copy Name"快速复制
4. **图形操作**: 拖拽平移、滚轮缩放

### 实时编辑
1. **修改参数**: 在Monaco Editor中编辑
2. **自动更新**: 图形实时反映代码变化
3. **布局调整**: 新参数自动加入对应列
4. **依赖更新**: 依赖关系箭头自动调整

## 🌟 总结

新的长方形节点和列式布局设计带来了：

✅ **更专业的外观**: 类似流程图的标准设计  
✅ **更清晰的组织**: 基础/计算参数明确分离  
✅ **更好的扩展性**: 支持大量参数的多列显示  
✅ **更高的可读性**: 长方形节点容纳更多信息  
✅ **更精确的交互**: 优化的点击和悬停区域  

现在访问 **http://127.0.0.1:8051** 体验全新的长方形节点和列式布局设计！