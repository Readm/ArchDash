# ArchDash ä¾èµ–å…³ç³»å›¾åŠŸèƒ½

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

ArchDash çš„æ–°å›¾ç³»ç»Ÿå®ç°äº†å¼ºå¤§çš„ä¾èµ–å…³ç³»ç®¡ç†å’Œè‡ªåŠ¨åˆ·æ–°åŠŸèƒ½ï¼Œä¸ºç”¨æˆ·æä¾›äº†å®Œæ•´çš„å‚æ•°ä¾èµ–å…³ç³»åˆ†æå’Œç®¡ç†å·¥å…·ã€‚

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½

### 1. ä¾èµ–å…³ç³»å›¾è·å–

#### `get_dependency_graph()` - æ­£å‘ä¾èµ–å…³ç³»å›¾
è·å–æ¯ä¸ªå‚æ•°çš„ä¾èµ–è€…åˆ—è¡¨ï¼Œæ˜¾ç¤ºå“ªäº›å‚æ•°ä¾èµ–äºæŸä¸ªå‚æ•°ã€‚

```python
from core import Graph

g = Graph("è®¾è®¡")
g["ç”µå‹"] = 1.8
g["æ ¸å¿ƒæ•°"] = 8

def power():
    return g["ç”µå‹"] ** 2 * g["æ ¸å¿ƒæ•°"] * 0.5

g.add_computed("åŠŸè€—", power)

# è·å–æ­£å‘ä¾èµ–å…³ç³»å›¾
dep_graph = g.get_dependency_graph()
print(dep_graph)
# è¾“å‡º: {'ç”µå‹': ['åŠŸè€—'], 'æ ¸å¿ƒæ•°': ['åŠŸè€—']}
```

#### `get_reverse_dependency_graph()` - åå‘ä¾èµ–å…³ç³»å›¾
è·å–æ¯ä¸ªå‚æ•°ä¾èµ–çš„å‚æ•°åˆ—è¡¨ï¼Œæ˜¾ç¤ºæŸä¸ªå‚æ•°ä¾èµ–äºå“ªäº›å‚æ•°ã€‚

```python
reverse_deps = g.get_reverse_dependency_graph()
print(reverse_deps)
# è¾“å‡º: {'åŠŸè€—': ['ç”µå‹', 'æ ¸å¿ƒæ•°'], 'ç”µå‹': [], 'æ ¸å¿ƒæ•°': []}
```

### 2. ä¾èµ–é“¾åˆ†æ

#### `get_dependency_chain()` - å®Œæ•´ä¾èµ–é“¾
è·å–ä»æ ¹å‚æ•°åˆ°ç›®æ ‡å‚æ•°çš„å®Œæ•´ä¾èµ–è·¯å¾„ã€‚

```python
chain = g.get_dependency_chain("åŠŸè€—")
print(chain)
# è¾“å‡º: ['ç”µå‹', 'æ ¸å¿ƒæ•°', 'åŠŸè€—']
```

#### `get_dependents_chain()` - ä¾èµ–è€…é“¾
è·å–ä»ç›®æ ‡å‚æ•°åˆ°æ‰€æœ‰æœ€ç»ˆä¾èµ–è€…çš„å®Œæ•´è·¯å¾„ã€‚

```python
dependents = g.get_dependents_chain("ç”µå‹")
print(dependents)
# è¾“å‡º: ['ç”µå‹', 'åŠŸè€—', ...]
```

### 3. è‡ªåŠ¨ä¾èµ–æ›´æ–°

#### å®æ—¶è‡ªåŠ¨æ›´æ–°
å‚æ•°ä¿®æ”¹æ—¶è‡ªåŠ¨åˆ·æ–°æ‰€æœ‰ä¾èµ–è€…ã€‚

```python
g["ç”µå‹"] = 1.2  # ä¿®æ”¹å‚æ•°
print(g["åŠŸè€—"])  # è‡ªåŠ¨é‡æ–°è®¡ç®—ï¼Œè¿”å›æ–°å€¼
```

#### `refresh_all_computed()` - åˆ·æ–°æ‰€æœ‰è®¡ç®—å‚æ•°
æ‰‹åŠ¨åˆ·æ–°å›¾ä¸­æ‰€æœ‰è®¡ç®—å‚æ•°çš„å€¼ã€‚

```python
g.refresh_all_computed()
```

#### `refresh_dependents()` - åˆ·æ–°æŒ‡å®šå‚æ•°çš„ä¾èµ–è€…
æ‰‹åŠ¨åˆ·æ–°æŒ‡å®šå‚æ•°çš„æ‰€æœ‰ä¾èµ–è€…ã€‚

```python
g.refresh_dependents("ç”µå‹")
```

## ğŸ“Š å®é™…åº”ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šå¤„ç†å™¨åŠŸè€—åˆ†æ

```python
from core import Graph

g = Graph("å¤„ç†å™¨åŠŸè€—åˆ†æ")

# è®¾ç½®åŸºç¡€å‚æ•°
g["å·¥è‰º_èŠ‚ç‚¹"] = 7
g["å·¥è‰º_ç”µå‹"] = 1.8
g["å·¥è‰º_é¢‘ç‡"] = 3.0
g["CPU_æ ¸å¿ƒæ•°"] = 8
g["GPU_æ ¸å¿ƒæ•°"] = 1024

# å®šä¹‰è®¡ç®—å‡½æ•°
def cpu_power():
    return g["å·¥è‰º_ç”µå‹"] ** 2 * g["CPU_æ ¸å¿ƒæ•°"] * g["å·¥è‰º_é¢‘ç‡"] * 0.3

def gpu_power():
    return g["GPU_æ ¸å¿ƒæ•°"] * g["å·¥è‰º_ç”µå‹"] * 0.001

def total_power():
    return g["CPU_åŠŸè€—"] + g["GPU_åŠŸè€—"] + 10  # 10WåŸºç¡€åŠŸè€—

def efficiency():
    return g["CPU_æ ¸å¿ƒæ•°"] * g["å·¥è‰º_é¢‘ç‡"] / g["æ€»åŠŸè€—"]

# æ·»åŠ è®¡ç®—å‚æ•°
g.add_computed("CPU_åŠŸè€—", cpu_power, "CPUåŠŸè€—è®¡ç®—")
g.add_computed("GPU_åŠŸè€—", gpu_power, "GPUåŠŸè€—è®¡ç®—")
g.add_computed("æ€»åŠŸè€—", total_power, "æ€»åŠŸè€—è®¡ç®—")
g.add_computed("èƒ½æ•ˆæ¯”", efficiency, "èƒ½æ•ˆæ¯”è®¡ç®—")

# åˆ†æä¾èµ–å…³ç³»
dep_graph = g.get_dependency_graph()
print("å…³é”®å‚æ•°çš„ä¾èµ–è€…:")
for param in ["å·¥è‰º_ç”µå‹", "å·¥è‰º_é¢‘ç‡", "CPU_æ ¸å¿ƒæ•°"]:
    if param in dep_graph:
        print(f"  {param} -> {dep_graph[param]}")

# æŸ¥çœ‹å¤æ‚å‚æ•°çš„ä¾èµ–é“¾
chain = g.get_dependency_chain("èƒ½æ•ˆæ¯”")
print(f"èƒ½æ•ˆæ¯”çš„å®Œæ•´ä¾èµ–é“¾: {' -> '.join(chain)}")

# æµ‹è¯•å·¥è‰ºå‡çº§å½±å“
print(f"åŸå§‹æ€»åŠŸè€—: {g['æ€»åŠŸè€—']:.2f}W")
print(f"åŸå§‹èƒ½æ•ˆæ¯”: {g['èƒ½æ•ˆæ¯”']:.2f}")

g["å·¥è‰º_èŠ‚ç‚¹"] = 5
g["å·¥è‰º_ç”µå‹"] = 1.2
g["å·¥è‰º_é¢‘ç‡"] = 3.5

print(f"å‡çº§åæ€»åŠŸè€—: {g['æ€»åŠŸè€—']:.2f}W")
print(f"å‡çº§åèƒ½æ•ˆæ¯”: {g['èƒ½æ•ˆæ¯”']:.2f}")
```

### ç¤ºä¾‹2ï¼šå¤šçº§ä¾èµ–ç®¡ç†

```python
from core import Graph

g = Graph("å¤šçº§ä¾èµ–æµ‹è¯•")

# åˆ›å»ºå¤šçº§ä¾èµ–ç»“æ„
g["åŸºç¡€å€¼"] = 10
g["ä¹˜æ•°"] = 2
g["åŠ æ•°"] = 5

def level1():
    return g["åŸºç¡€å€¼"] * g["ä¹˜æ•°"]

def level2():
    return g["ä¸€çº§ç»“æœ"] + g["åŠ æ•°"]

def level3():
    return g["äºŒçº§ç»“æœ"] * 1.5

def final_result():
    return g["ä¸€çº§ç»“æœ"] + g["äºŒçº§ç»“æœ"] + g["ä¸‰çº§ç»“æœ"]

g.add_computed("ä¸€çº§ç»“æœ", level1)
g.add_computed("äºŒçº§ç»“æœ", level2)
g.add_computed("ä¸‰çº§ç»“æœ", level3)
g.add_computed("æœ€ç»ˆç»“æœ", final_result)

# åˆ†æä¾èµ–å…³ç³»
reverse_deps = g.get_reverse_dependency_graph()
print("å¤šçº§ä¾èµ–ç»“æ„:")
for param in ["ä¸€çº§ç»“æœ", "äºŒçº§ç»“æœ", "ä¸‰çº§ç»“æœ", "æœ€ç»ˆç»“æœ"]:
    deps = reverse_deps.get(param, [])
    print(f"  {param} <- {deps}")

# æµ‹è¯•æ‰¹é‡ä¿®æ”¹å’Œè‡ªåŠ¨æ›´æ–°
print(f"åŸå§‹æœ€ç»ˆç»“æœ: {g['æœ€ç»ˆç»“æœ']}")

g["åŸºç¡€å€¼"] = 20
g["ä¹˜æ•°"] = 3
print(f"ä¿®æ”¹åæœ€ç»ˆç»“æœ: {g['æœ€ç»ˆç»“æœ']}")

# æ‰‹åŠ¨åˆ·æ–°éªŒè¯
g.refresh_all_computed()
print(f"æ‰‹åŠ¨åˆ·æ–°åæœ€ç»ˆç»“æœ: {g['æœ€ç»ˆç»“æœ']}")
```

## ğŸ”§ é«˜çº§åŠŸèƒ½

### 1. å¾ªç¯ä¾èµ–æ£€æµ‹
ç³»ç»Ÿè‡ªåŠ¨æ£€æµ‹å¹¶å¤„ç†å¾ªç¯ä¾èµ–ï¼Œé¿å…æ— é™é€’å½’ã€‚

### 2. æ€§èƒ½ä¼˜åŒ–
- æƒ°æ€§è®¡ç®—ï¼šåªåœ¨éœ€è¦æ—¶è®¡ç®—å‚æ•°å€¼
- æ™ºèƒ½å¤±æ•ˆï¼šåªå¤±æ•ˆçœŸæ­£éœ€è¦æ›´æ–°çš„å‚æ•°
- é¿å…é‡å¤è®¡ç®—ï¼šç›¸åŒå‚æ•°åœ¨ä¸€æ¬¡æ›´æ–°ä¸­åªè®¡ç®—ä¸€æ¬¡

### 3. é”™è¯¯å¤„ç†
- è®¡ç®—é”™è¯¯æ—¶è¿”å›é»˜è®¤å€¼
- è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œè°ƒè¯•æ”¯æŒ
- ä¼˜é›…çš„é”™è¯¯æ¢å¤æœºåˆ¶

## ğŸ‰ ä¸æ—§ç³»ç»Ÿçš„å¯¹æ¯”

| åŠŸèƒ½ | æ—§ç³»ç»Ÿ (models.py) | æ–°ç³»ç»Ÿ (core/graph.py) |
|------|-------------------|------------------------|
| ä¾èµ–å…³ç³»å›¾ | å¤æ‚çš„å†…éƒ¨æ˜ å°„ | ç®€å•çš„APIè°ƒç”¨ |
| ä¾èµ–é“¾åˆ†æ | æœ‰é™çš„åŠŸèƒ½ | å®Œæ•´çš„é“¾å¼åˆ†æ |
| è‡ªåŠ¨æ›´æ–° | æ‰‹åŠ¨è§¦å‘ | å®Œå…¨è‡ªåŠ¨ |
| æ€§èƒ½ | é‡å¤è®¡ç®— | æ™ºèƒ½ç¼“å­˜ |
| æ˜“ç”¨æ€§ | å¤æ‚çš„æ¥å£ | æç®€çš„API |
| è°ƒè¯•æ”¯æŒ | æœ‰é™ | å®Œæ•´çš„å·¥å…·é“¾ |

## ğŸ“ˆ æ€§èƒ½ç‰¹ç‚¹

- **ğŸ“Š å®æ—¶åˆ†æ**: å³æ—¶è·å–ä¾èµ–å…³ç³»å›¾
- **ğŸ”„ è‡ªåŠ¨æ›´æ–°**: å‚æ•°ä¿®æ”¹æ—¶è‡ªåŠ¨åˆ·æ–°ä¾èµ–è€…
- **ğŸ¯ ç²¾å‡†å¤±æ•ˆ**: åªæ›´æ–°çœŸæ­£éœ€è¦æ›´æ–°çš„å‚æ•°
- **âš¡ é«˜æ•ˆè®¡ç®—**: é¿å…é‡å¤è®¡ç®—å’Œæ— æ•ˆæ“ä½œ
- **ğŸ›¡ï¸ é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯æ£€æµ‹å’Œæ¢å¤æœºåˆ¶
- **ğŸ” è°ƒè¯•å‹å¥½**: è¯¦ç»†çš„ä¾èµ–é“¾å’ŒçŠ¶æ€ä¿¡æ¯

## ğŸ’¡ æœ€ä½³å®è·µ

1. **åˆç†ä½¿ç”¨ä¾èµ–é“¾åˆ†æ**ï¼š
   - ä½¿ç”¨ `get_dependency_chain()` ç†è§£å¤æ‚å‚æ•°çš„ä¾èµ–å…³ç³»
   - ä½¿ç”¨ `get_dependents_chain()` è¯„ä¼°å‚æ•°ä¿®æ”¹çš„å½±å“èŒƒå›´

2. **æ™ºèƒ½åˆ·æ–°ç­–ç•¥**ï¼š
   - è®©ç³»ç»Ÿè‡ªåŠ¨å¤„ç†å¤§éƒ¨åˆ†æ›´æ–°
   - åœ¨æ‰¹é‡ä¿®æ”¹åä½¿ç”¨ `refresh_all_computed()` ç¡®ä¿ä¸€è‡´æ€§
   - ä½¿ç”¨ `refresh_dependents()` è¿›è¡Œç²¾ç¡®çš„å±€éƒ¨æ›´æ–°

3. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - é¿å…åˆ›å»ºè¿‡æ·±çš„ä¾èµ–é“¾
   - åˆç†åˆ†ç»„ç›¸å…³å‚æ•°
   - ä½¿ç”¨æè¿°æ€§çš„å‚æ•°åç§°ä¾¿äºè°ƒè¯•

4. **é”™è¯¯å¤„ç†**ï¼š
   - åœ¨è®¡ç®—å‡½æ•°ä¸­æ·»åŠ é€‚å½“çš„é”™è¯¯å¤„ç†
   - ä½¿ç”¨ `get_computed_info()` æ£€æŸ¥è®¡ç®—çŠ¶æ€
   - å®šæœŸæ£€æŸ¥ä¾èµ–å…³ç³»å›¾çš„å®Œæ•´æ€§

è¿™äº›åŠŸèƒ½ä½¿å¾— ArchDash å…·æœ‰äº†å·¥ä¸šçº§çš„ä¾èµ–å…³ç³»ç®¡ç†èƒ½åŠ›ï¼Œä¸ºå¤æ‚çš„å‚æ•°åŒ–è®¾è®¡æä¾›äº†å¼ºå¤§çš„æ”¯æŒã€‚