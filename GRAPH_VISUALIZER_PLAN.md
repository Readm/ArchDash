# Graph Visualizer - 可视化代码依赖图工具

## 🎯 项目概述

Graph Visualizer 是一个本地GUI工具，用于可视化Python代码中的Graph参数依赖关系。它提供双面板界面：左侧显示依赖关系图，右侧显示源码编辑器，支持交互式代码编辑和实时图形更新。

## 🏗️ 技术架构

### 核心组件
1. **代码解析器 (CodeParser)**: 解析Python代码，提取Graph定义和依赖关系
2. **图形可视化器 (GraphVisualizer)**: 使用matplotlib/networkx渲染依赖图
3. **GUI界面**: 双面板布局，代码编辑器 + 图形显示
4. **交互功能**: 节点点击跳转到对应代码行

### 技术选择
- **GUI框架**: matplotlib (基础版) / tkinter (完整版)
- **图形渲染**: matplotlib + networkx
- **代码解析**: 正则表达式 + AST解析
- **字体支持**: 处理中文显示

## 📅 实现阶段

### ✅ 已完成功能

#### 阶段1: 基础框架
- [x] 双面板GUI布局 (matplotlib版本)
- [x] 代码编辑器组件 (TextBox)
- [x] 图形显示区域设置
- [x] 基础交互按钮 (Refresh, Sample, Clear)

#### 阶段2: 代码解析
- [x] Graph创建语句解析 (`Graph("name")`)
- [x] 基础参数解析 (`g["param"] = value`)
- [x] 计算参数解析 (`add_computed` 调用)
- [x] 函数依赖关系提取 (`g["param"]` 引用)
- [x] 错误处理和用户反馈

#### 阶段3: 可视化实现
- [x] networkx依赖图构建
- [x] 节点颜色区分 (蓝色=基础参数, 绿色=计算参数)
- [x] 圆形布局算法
- [x] 箭头连接线显示依赖关系
- [x] 参数值标签显示
- [x] 图例和统计信息

#### 阶段4: 用户体验
- [x] 示例代码加载
- [x] 实时代码编辑和刷新
- [x] 错误信息显示
- [x] 中文字体支持警告处理

## 🛠️ 文件结构

### 可视化工具文件
```
ArchDash/
├── graph_visualizer.py           # 完整版 (tkinter + matplotlib)
├── simple_graph_visualizer.py    # 高级版 (matplotlib + networkx)
├── basic_graph_visualizer.py     # 基础版 (仅matplotlib)
├── demo.py                       # 现有的命令行演示
├── test_visualizer.py           # 测试文件
├── requirements_visualizer.txt   # 依赖包列表
└── GRAPH_VISUALIZER_PLAN.md     # 本文档
```

### 核心功能文件
```
ArchDash/
├── core/
│   └── graph.py                  # Graph核心实现
├── tests/new_graph_tests/        # 新测试套件
└── CLEANUP_SUMMARY.md           # 清理工作总结
```

## 🎨 界面设计

### 布局结构
```
┌─────────────────────────────────────────────────────────────┐
│  Graph Visualizer - 代码依赖图可视化工具                    │
├─────────────────┬───────────────────────────────────────────┤
│                 │                                           │
│   依赖关系图     │              代码编辑器                  │
│                 │                                           │
│  ┌─────────────┐│  from core import Graph                   │
│  │   voltage   ││                                           │
│  │    12.0     ││  g = Graph("电路分析")                    │
│  └─────┬───────┘│                                           │
│        │        │  g["voltage"] = 12.0                      │
│        ▼        │  g["current"] = 2.0                       │
│  ┌─────────────┐│                                           │
│  │    power    ││  def power_calculation():                │
│  │ computed... ││      return g["voltage"] * g["current"]   │
│  └─────────────┘│                                           │
│                 │  g.add_computed("power", power_...)      │
├─────────────────┼───────────────────────────────────────────┤
│ [Refresh] [Sample] [Clear]                                  │
└─────────────────────────────────────────────────────────────┘
```

### 功能特性
- **节点着色**: 蓝色=基础参数, 绿色=计算参数
- **依赖箭头**: 显示参数间的依赖关系
- **参数值**: 节点下方显示当前值
- **交互点击**: 点击节点跳转到代码 (tkinter版本)
- **实时更新**: 修改代码后可刷新图形

## 🚀 使用方法

### 快速开始
```bash
# 安装依赖
pip install matplotlib networkx numpy

# 运行基础版本 (最稳定)
python basic_graph_visualizer.py

# 运行高级版本 (包含networkx)
python simple_graph_visualizer.py

# 运行完整版本 (需要tkinter支持)
python graph_visualizer.py
```

### 操作步骤
1. **启动工具**: 运行任一可视化脚本
2. **加载示例**: 点击 "Sample" 按钮查看示例代码
3. **编辑代码**: 在右侧编辑器中修改代码
4. **刷新图形**: 点击 "Refresh" 按钮更新可视化
5. **交互浏览**: 查看节点和依赖关系

### 支持的代码模式
```python
# 1. 图创建
g = Graph("图名称")

# 2. 基础参数
g["参数名"] = 值

# 3. 计算函数定义
def 计算函数():
    return g["依赖参数1"] + g["依赖参数2"]

# 4. 计算参数添加
g.add_computed("计算参数名", 计算函数, "描述")
```

## 🎯 核心算法

### 代码解析算法
1. **正则表达式匹配**: 提取Graph创建和参数赋值
2. **函数定义识别**: 解析def语句和函数体
3. **依赖关系提取**: 在函数中查找`g["参数"]`引用
4. **add_computed解析**: 匹配计算参数添加语句

### 图形布局算法
1. **节点定位**: 圆形布局或spring布局
2. **边绘制**: 依赖关系的有向箭头
3. **标签显示**: 参数名和值的文本标签
4. **颜色编码**: 参数类型的视觉区分

## ⚡ 性能优化

### 解析性能
- 使用正则表达式进行快速文本匹配
- 避免完整AST解析，只提取关键信息
- 缓存解析结果，避免重复计算

### 渲染性能
- 简化的图形绘制，避免复杂动画
- 合理的节点数量限制 (建议<50个节点)
- 高效的布局算法选择

## 🐛 已知问题与解决方案

### 字体显示问题
- **问题**: matplotlib缺少中文字体支持
- **影响**: 中文标签显示为方块
- **解决方案**: 使用英文标签或安装中文字体

### GUI兼容性
- **问题**: WSL环境中GUI显示问题
- **影响**: 可能无法正确显示窗口
- **解决方案**: 使用X11转发或在本地环境运行

### 依赖解析限制
- **问题**: 复杂Python语法可能解析失败
- **影响**: 部分依赖关系可能遗漏
- **解决方案**: 使用标准化的Graph API语法

## 🔮 未来改进方向

### 功能增强
- [ ] **实时解析**: 代码输入时实时更新图形
- [ ] **代码高亮**: 语法高亮显示
- [ ] **错误定位**: 精确的错误行号定位
- [ ] **导出功能**: 图形导出为PNG/SVG
- [ ] **布局选择**: 多种图形布局算法

### 交互改进
- [ ] **节点详情**: 鼠标悬停显示详细信息
- [ ] **缩放平移**: 图形的缩放和平移操作
- [ ] **搜索功能**: 参数名搜索和高亮
- [ ] **历史记录**: 代码编辑的撤销重做

### 性能优化
- [ ] **增量解析**: 只解析变化的代码部分
- [ ] **虚拟化渲染**: 大图的分页显示
- [ ] **多线程**: 解析和渲染的异步处理

## 📊 测试覆盖

### 解析器测试
- [x] 基础参数解析
- [x] 计算参数解析
- [x] 依赖关系提取
- [x] 错误处理

### 可视化测试
- [x] 图形渲染
- [x] 节点布局
- [x] 交互功能
- [x] 用户界面

## 🎉 项目成果

### 已实现的核心功能
1. **完整的双面板GUI**: 代码编辑 + 图形可视化
2. **智能代码解析**: 自动提取Graph定义和依赖
3. **直观的图形显示**: 节点-边模型显示依赖关系
4. **实时交互更新**: 代码修改后即时刷新
5. **多版本支持**: 从基础到完整的不同复杂度版本

### 技术价值
- **简化调试**: 可视化帮助理解复杂的参数依赖关系
- **代码验证**: 图形化验证依赖关系的正确性
- **开发效率**: 快速定位参数定义和使用位置
- **文档生成**: 自动生成依赖关系文档

### 用户体验
- **直观易用**: 双面板设计，左图右代码
- **即时反馈**: 实时解析和图形更新
- **错误提示**: 清晰的错误信息显示
- **示例驱动**: 内置示例代码快速上手

## 🏁 总结

Graph Visualizer 成功实现了**代码依赖图可视化**的核心目标：

✅ **双面板GUI**: 左侧图形，右侧代码  
✅ **自动解析**: 智能提取Graph结构  
✅ **实时更新**: 修改代码即时刷新图形  
✅ **交互功能**: 点击跳转，直观操作  
✅ **本地运行**: 无需Web服务器，纯本地GUI  

这个工具为Graph系统提供了强大的可视化调试和开发支持，大大提升了复杂依赖关系的理解和维护效率。通过多个版本的实现，用户可以根据环境需求选择最适合的版本使用。