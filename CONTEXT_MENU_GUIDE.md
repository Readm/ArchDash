# 上下文菜单功能指南

## 🎉 新功能：单击节点弹出菜单

现在您的图形可视化工具支持智能上下文菜单！

## 🎮 使用方法

### 1. 显示菜单
- **单击任意节点** → 弹出上下文菜单
- 菜单显示在图形右侧，包含节点详细信息

### 2. 菜单内容
菜单包含以下信息和功能：

#### 📊 节点信息
- **参数名称**：显示在菜单标题
- **参数类型**：basic 或 computed
- **代码行号**：参数定义所在行
- **参数值**：当前值或计算表达式

#### 🔧 操作按钮

1. **🔍 Jump to Code**
   - 点击跳转到对应代码行
   - 在目标行添加 `# <-- TARGET` 标记
   - 自动移除之前的标记

2. **📋 Copy Name**
   - 复制参数名称到剪贴板
   - 方便在代码中引用

3. **❌ Close**
   - 关闭上下文菜单

### 3. 关闭菜单
- 点击"Close"按钮
- 点击图形空白区域
- 点击其他节点（会显示新菜单）

## 🎯 功能特点

### ✅ 智能定位
- 菜单自动出现在合适位置
- 避免超出屏幕边界
- 固定在图形右侧区域

### ✅ 详细信息
- 显示完整的参数信息
- 包含行号便于定位
- 区分基础参数和计算参数

### ✅ 快速操作
- 一键跳转到代码位置
- 一键复制参数名称
- 直观的按钮图标

### ✅ 视觉反馈
- 在代码中添加临时标记
- 清晰的菜单样式
- 响应式设计

## 💡 使用技巧

### 代码跳转
1. 单击节点弹出菜单
2. 点击"🔍 Jump to Code"
3. 在代码编辑器中查找 `# <-- TARGET` 标记
4. 标记会自动出现在目标行末尾

### 快速编辑
1. 使用跳转功能定位到参数
2. 直接修改参数值
3. 图形会自动更新

### 参数引用
1. 使用"📋 Copy Name"复制参数名
2. 在新的函数中粘贴引用
3. 建立新的依赖关系

## 🔧 技术实现

### 前端交互
- 使用Plotly的点击事件捕获
- JavaScript动态显示/隐藏菜单
- CSS定位和样式控制

### 后端处理
- Dash回调处理菜单内容
- 代码解析器提供行号信息
- 动态修改代码内容

### 数据流
1. 点击节点 → 触发JavaScript回调
2. 提取节点数据 → 更新菜单内容
3. 点击按钮 → 触发Python回调
4. 执行操作 → 更新界面

## 🎮 操作演示

### 场景1：查看基础参数
```
1. 点击蓝色节点（如"voltage"）
2. 菜单显示：
   - 名称：voltage
   - 类型：basic
   - 行号：7
   - 值：12.0
3. 点击"Jump to Code"
4. 代码第7行出现：g["voltage"] = 12.0  # <-- TARGET
```

### 场景2：查看计算参数
```
1. 点击绿色节点（如"power"）
2. 菜单显示：
   - 名称：power
   - 类型：computed
   - 行号：25
   - 值：computed via power_calculation()
3. 点击"Jump to Code"
4. 代码第25行出现：g.add_computed("power", power_calculation, ...)  # <-- TARGET
```

## 🎯 优势对比

### 相比双击操作：
- ✅ 不与Plotly默认行为冲突
- ✅ 提供更多操作选项
- ✅ 显示详细信息
- ✅ 更好的用户体验

### 相比悬停提示：
- ✅ 信息显示时间更长
- ✅ 支持交互操作
- ✅ 更清晰的布局
- ✅ 可复制和跳转

现在您可以在 http://127.0.0.1:8051 体验这个强大的上下文菜单功能！